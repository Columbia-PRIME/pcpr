<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Principal Component Pursuit for Environmental Epidemiology • pcpr</title>
<script src="lightswitch.js"></script><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><script src="deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Principal Component Pursuit for Environmental Epidemiology">
<meta name="description" content="Implementation of the pattern recognition technique Principal Component Pursuit tailored to environmental health data, as described in Gibson et al. (2022) &lt;doi:10.1289/EHP10479&gt;.">
<meta property="og:description" content="Implementation of the pattern recognition technique Principal Component Pursuit tailored to environmental health data, as described in Gibson et al. (2022) &lt;doi:10.1289/EHP10479&gt;.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">pcpr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/pcp-applied.html">Air pollution source apportionment with PCP</a></li>
    <li><a class="dropdown-item" href="articles/pcp-quickstart.html">Quickstart: applying PCP to a simulated environmental mixture</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Columbia-PRIME/pcpr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="pcpr">pcpr<a class="anchor" aria-label="anchor" href="#pcpr"></a>
</h1></div>
<!-- badges: start -->

<p>The R package <code>pcpr</code> implements Principal Component Pursuit (PCP), a robust dimensionality reduction technique, for pattern recognition tailored to environmental health data. The statistical methodology and computational details are provided in <a href="https://doi.org/10.1289/EHP10479" class="external-link">Gibson et al. (2022)</a>.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of pcpr from GitHub with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("pak")</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"Columbia-PRIME/pcpr"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="modeling-overview">Modeling overview<a class="anchor" aria-label="anchor" href="#modeling-overview"></a>
</h2>
<p>PCP algorithms model an observed exposure matrix <span class="math inline">\(D\)</span> as the sum of three underlying ground-truth matrices:</p>
<p><img src="reference/figures/README-pcp-model-1.jpeg" alt="An example PCP model"><!-- $$\underset{\text{mixture}}{D_{n \times p}} = \underset{\text{low-rank}}{L_0} + \underset{\text{sparse}}{S_0} + \underset{\text{noise}}{Z_0}$$ --></p>
<p>a low-rank matrix <span class="math inline">\(L_0\)</span> encoding consistent patterns of exposure, a sparse matrix <span class="math inline">\(S_0\)</span> isolating unique or outlying exposure events (that cannot be explained by the consistent exposure patterns), and dense noise <span class="math inline">\(Z_0\)</span>. All of these matrices are of dimension <span class="math inline">\(n \times p\)</span>, where <span class="math inline">\(n\)</span> is the number of observations (e.g. study participants or measurement dates) and <span class="math inline">\(p\)</span> is the number of exposures (e.g. chemical and/or non-chemical stressors). Beyond this mixtures model, the main assumption made by PCP is that <span class="math inline">\(Z_0 \sim \mathcal{N}(\mu, \sigma^2)\)</span> consists of i.i.d. Gaussian noise corrupting each entry of the overall exposure matrix <span class="math inline">\(D\)</span>.</p>
<p>The models in <code>pcpr</code> seek to decompose an observed data matrix <code>D</code> into estimated low-rank and sparse components <code>L</code> and <code>S</code> for use in downstream environmental health analyses. The functions in <code>pcpr</code> are outfitted with three environmental health (EH)-specific extensions making <code>pcpr</code> particularly powerful for EH research:</p>
<ol style="list-style-type: decimal">
<li>Missing value functionality</li>
<li>Leveraging potential limit of detection (LOD) information</li>
<li>Non-negativity constraint on the estimated <code>L</code> matrix</li>
</ol>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p><code>pcpr</code> supplies all of the functions needed to incorporate PCP into an environmental health analyses.</p>
<p>Below we run through a brief example, using <code>pcpr</code> to simulate an environmental mixture and then recover the mixture’s underlying consistent patterns and sparse outliers.</p>
<div class="section level3">
<h3 id="simulating-data">Simulating data<a class="anchor" aria-label="anchor" href="#simulating-data"></a>
</h3>
<p>The <code><a href="reference/sim_data.html">sim_data()</a></code> function lets users generate simple mixtures models for quick experimentation. Let’s use it to simulate a noisy environmental mixture comprised of 100 observations of 10 chemicals, with three underlying chemical exposure patterns (or a rank <span class="math inline">\(r = 3\)</span>), extreme outlying exposure events along the diagonal of the matrix, and dense Gaussian noise corrupting all the measurements in the matrix:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://columbia-prime.github.io/pcpr/">pcpr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/sim_data.html">sim_data</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">100</span>, p <span class="op">=</span> <span class="fl">10</span>, r <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  sparse_nonzero_idxs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1000</span>, <span class="fl">101</span><span class="op">)</span>,</span>
<span>  sigma <span class="op">=</span> <span class="fl">0.05</span></span>
<span><span class="op">)</span></span>
<span><span class="va">D</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">D</span></span>
<span><span class="va">L_0</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">L</span></span>
<span><span class="va">S_0</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">S</span></span>
<span><span class="va">Z_0</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">Z</span></span></code></pre></div>
<p>We can see <code>L_0</code> has 3 underlying patterns using the <code><a href="reference/matrix_rank.html">matrix_rank()</a></code> function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/matrix_rank.html">matrix_rank</a></span><span class="op">(</span><span class="va">L_0</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3</span></span></code></pre></div>
<p>Because our mixtures data is often incomplete in practice, let’s simulate a random 5% of the values as missing <code>NA</code> with the <code><a href="reference/corrupt_mat_randomly.html">corrupt_mat_randomly()</a></code> function:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">corrupted_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/corrupt_mat_randomly.html">corrupt_mat_randomly</a></span><span class="op">(</span><span class="va">D</span>, perc <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">D_tilde</span> <span class="op">&lt;-</span> <span class="va">corrupted_data</span><span class="op">$</span><span class="va">D_tilde</span></span>
<span><span class="va">D_tilde_0fill</span> <span class="op">&lt;-</span> <span class="va">D_tilde</span></span>
<span><span class="va">D_tilde_0fill</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">D_tilde</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span></code></pre></div>
<p>The <code>D_tilde</code> matrix represents our observed, messy mixtures model, suffering from incomplete <code>NA</code> observations. In a moment we will run our PCP model on <code>D_tilde</code> directly. The <code>D_tilde_0fill</code> matrix imputes <code>NA</code> values with <code>0</code>, allowing us to call functions that do not support missing <code>NA</code> values.</p>
</div>
<div class="section level3">
<h3 id="pcp-model-selection">PCP model selection<a class="anchor" aria-label="anchor" href="#pcp-model-selection"></a>
</h3>
<p>There are two PCP algorithms shipped with <code>pcpr</code>: the convex <code><a href="reference/root_pcp.html">root_pcp()</a></code> [<a href="https://proceedings.neurips.cc/paper/2021/hash/f65854da4622c1f1ad4ffeb361d7703c-Abstract.html" class="external-link">Zhang et al. (2021)</a>] and non-convex <code><a href="reference/rrmc.html">rrmc()</a></code> [<a href="https://proceedings.mlr.press/v70/cherapanamjeri17a.html" class="external-link">Cherapanamjeri et al. (2017)</a>]. To figure out which model would be best for our data, let’s inspect the singular values of our observed mixture using the <code><a href="reference/sing.html">sing()</a></code> method:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="reference/sing.html">sing</a></span><span class="op">(</span><span class="va">D_tilde_0fill</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"b"</span>, main <span class="op">=</span> <span class="st">"Singular values of the observed mixture"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-sing-1.png" width="100%"></p>
<p><code><a href="reference/rrmc.html">rrmc()</a></code> is best suited for data characterized by slowly decaying singular values, indicative of complex underlying patterns. Most EH data can be described this way. <code><a href="reference/root_pcp.html">root_pcp()</a></code> is best for data characterized by rapidly decaying singular values, indicative of very well-defined latent patterns.</p>
<p>For a simple example like the above, both PCP models are perfectly suitable. We will use <code><a href="reference/rrmc.html">rrmc()</a></code>, as this is the model environmental health researchers will likely employ most frequently.</p>
</div>
<div class="section level3">
<h3 id="tuning-pcp-parameters-via-grid-search">Tuning PCP parameters via grid search<a class="anchor" aria-label="anchor" href="#tuning-pcp-parameters-via-grid-search"></a>
</h3>
<p>To estimate the low-rank and sparse matrices, <code><a href="reference/rrmc.html">rrmc()</a></code> needs to be given a maximum rank <code>r</code> and regularization parameter <code>eta</code>. To determine the optimal values of <code>r</code> and <code>eta</code>, we will conduct a brief grid search using the <code><a href="reference/grid_search_cv.html">grid_search_cv()</a></code> function. In our grid search below, we will examine all models from ranks 1 through 5 and all values of <code>eta</code> near the default, calculated with <code><a href="reference/get_pcp_defaults.html">get_pcp_defaults()</a></code>.</p>
<p>The <code><a href="reference/rrmc.html">rrmc()</a></code> approach to PCP uses an iterative rank-based procedure to recover <code>L</code> and <code>S</code>, meaning it first constructs a rank <code>1</code> model and iteratively builds up to the specified rank <code>r</code> solution. As such, for our grid search with <code><a href="reference/grid_search_cv.html">grid_search_cv()</a></code>, we pass <code>etas</code> as the <code>grid</code> argument we are searching and we send <code>r</code> = 5 as a constant parameter common to all models in the search. Since <code>length(etas) = 6</code> and <code>r</code> = 5, we are grid searching through 30 different PCP models. The <code>num_runs</code> argument in <code><a href="reference/grid_search_cv.html">grid_search_cv()</a></code> determines how many (random) tests should be performed for each unique model setting. By default, <code>num_runs = 100</code>, so our grid search tunes <code>r</code> and <code>eta</code> by measuring the performance of 300 different PCP models.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eta_0</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_pcp_defaults.html">get_pcp_defaults</a></span><span class="op">(</span><span class="va">D_tilde</span><span class="op">)</span><span class="op">$</span><span class="va">eta</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Default eta value: "</span>, <span class="va">eta_0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Default eta value:  0.0447213595499958</span></span>
<span><span class="va">etas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"eta"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span> <span class="op">*</span> <span class="va">eta_0</span>, <span class="va">eta_0</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">gs</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/grid_search_cv.html">grid_search_cv</a></span><span class="op">(</span><span class="va">D_tilde</span>, pcp_fn <span class="op">=</span> <span class="va">rrmc</span>, grid <span class="op">=</span> <span class="va">etas</span>, r <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Initializing gridsearch...</span></span>
<span><span class="co">#&gt; The completed gridsearch will NOT be saved to any files, but simply returned.</span></span>
<span><span class="co">#&gt; Beginning parallel gridsearch using 16 cores and a multisession strategy...</span></span>
<span><span class="co">#&gt; Start time: 2025-03-20 01:02:07.802605</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Gridsearch completed at time: 2025-03-20 01:02:17.022088</span></span>
<span><span class="co">#&gt; Metrics calculations complete.</span></span>
<span><span class="va">r_star</span> <span class="op">&lt;-</span> <span class="va">gs</span><span class="op">$</span><span class="va">summary_stats</span><span class="op">$</span><span class="va">r</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">eta_star</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">gs</span><span class="op">$</span><span class="va">summary_stats</span><span class="op">$</span><span class="va">eta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">gs</span><span class="op">$</span><span class="va">summary_stats</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 7</span></span>
<span><span class="co">#&gt;     eta     r rel_err L_rank S_sparsity iterations run_error_perc</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;         </span></span>
<span><span class="co">#&gt; 1 0.224     3   0.135   3          98.9        NaN 0%            </span></span>
<span><span class="co">#&gt; 2 0.313     3   0.137   3          99.0        NaN 0%            </span></span>
<span><span class="co">#&gt; 3 0.134     3   0.143   3          31.8        NaN 0%            </span></span>
<span><span class="co">#&gt; 4 0.134     4   0.143   3.03       30.8        NaN 0%            </span></span>
<span><span class="co">#&gt; 5 0.134     5   0.143   3.03       30.8        NaN 0%            </span></span>
<span><span class="co">#&gt; 6 0.224     4   0.155   4          99.0        NaN 0%</span></span></code></pre></div>
<p>Inspecting the <code>summary_stats</code> table from the output grid search provides the mean aggregated statistics for each of the 30 distinct parameter settings we tested. The grid search correctly identified the rank 3 solution as the best (lowest relative error rate). The corresponding <code>eta</code> = 0.224.</p>
</div>
<div class="section level3">
<h3 id="running-pcp">Running PCP<a class="anchor" aria-label="anchor" href="#running-pcp"></a>
</h3>
<p>Now we can run our PCP model:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pcp_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/rrmc.html">rrmc</a></span><span class="op">(</span><span class="va">D_tilde</span>, r <span class="op">=</span> <span class="va">r_star</span>, eta <span class="op">=</span> <span class="va">eta_star</span><span class="op">)</span></span></code></pre></div>
<p>Let’s briefly inspect PCP’s estimate of the sparse matrix <code>S</code>, and fix any values that are “practically” zero using the <code><a href="reference/hard_threshold.html">hard_threshold()</a></code> function. The histogram below shows a majority of the entries in <code>S</code> are between -0.2 and 0.2, so we will call those values “practically” zero, and the rest true outlying exposure events.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">pcp_model</span><span class="op">$</span><span class="va">S</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-sparse-1.png" width="100%"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pcp_model</span><span class="op">$</span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/hard_threshold.html">hard_threshold</a></span><span class="op">(</span><span class="va">pcp_model</span><span class="op">$</span><span class="va">S</span>, thresh <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="benchmarking-with-pca">Benchmarking with PCA<a class="anchor" aria-label="anchor" href="#benchmarking-with-pca"></a>
</h3>
<p>Before evaluating our PCP model, let’s see how well a more traditional method such as Principal Compoenents Analysis (PCA) can recover <code>L_0</code>, to provide a benchmark for comparison.</p>
<p>The <code><a href="reference/proj_rank_r.html">proj_rank_r()</a></code> function (project matrix to rank <code>r</code>) approximates an input matrix as low-rank using a rank-<code>r</code> truncated SVD, the same way PCA approximates a low-rank matrix. Normally, a researcher would need to determine <code>r</code> subjectively. We will give PCA an advantage by sharing PCP’s discovery from the above grid search that the solution should be of rank 3:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">L_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/proj_rank_r.html">proj_rank_r</a></span><span class="op">(</span><span class="va">D_tilde_0fill</span>, r <span class="op">=</span> <span class="va">r_star</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="evaluating-pcp-against-the-ground-truth">Evaluating PCP against the ground truth<a class="anchor" aria-label="anchor" href="#evaluating-pcp-against-the-ground-truth"></a>
</h3>
<p>Finally, let’s see how we did in recovering <code>L_0</code> and <code>S_0</code>. We will examine the relative error between our model’s estimates and the simulated ground truth matrices. We use the Frobenius norm to calculate the relative errors between the matrices:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  <span class="st">"Obs_rel_err"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/norm.html" class="external-link">norm</a></span><span class="op">(</span><span class="va">L_0</span> <span class="op">-</span> <span class="va">D_tilde_0fill</span>, <span class="st">"F"</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/norm.html" class="external-link">norm</a></span><span class="op">(</span><span class="va">L_0</span>, <span class="st">"F"</span><span class="op">)</span>,</span>
<span>  <span class="st">"PCA_L_rel_err"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/norm.html" class="external-link">norm</a></span><span class="op">(</span><span class="va">L_0</span> <span class="op">-</span> <span class="va">L_pca</span>, <span class="st">"F"</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/norm.html" class="external-link">norm</a></span><span class="op">(</span><span class="va">L_0</span>, <span class="st">"F"</span><span class="op">)</span>,</span>
<span>  <span class="st">"PCP_L_rel_err"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/norm.html" class="external-link">norm</a></span><span class="op">(</span><span class="va">L_0</span> <span class="op">-</span> <span class="va">pcp_model</span><span class="op">$</span><span class="va">L</span>, <span class="st">"F"</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/norm.html" class="external-link">norm</a></span><span class="op">(</span><span class="va">L_0</span>, <span class="st">"F"</span><span class="op">)</span>,</span>
<span>  <span class="st">"PCP_S_rel_err"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/norm.html" class="external-link">norm</a></span><span class="op">(</span><span class="va">S_0</span> <span class="op">-</span> <span class="va">pcp_model</span><span class="op">$</span><span class="va">S</span>, <span class="st">"F"</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/norm.html" class="external-link">norm</a></span><span class="op">(</span><span class="va">S_0</span>, <span class="st">"F"</span><span class="op">)</span>,</span>
<span>  <span class="st">"PCP_L_rank"</span> <span class="op">=</span> <span class="fu"><a href="reference/matrix_rank.html">matrix_rank</a></span><span class="op">(</span><span class="va">pcp_model</span><span class="op">$</span><span class="va">L</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   Obs_rel_err PCA_L_rel_err PCP_L_rel_err PCP_S_rel_err PCP_L_rank</span></span>
<span><span class="co">#&gt; 1   0.2944351     0.2340244    0.03337159    0.05924514          3</span></span></code></pre></div>
<p>PCP outperformed PCA by quite a bit! PCP’s relative recovery error on the <code>L_0</code> matrix stood at only 3.34%, compared to an observed relative error of 29.44% and PCA’s relative error of 23.4%. PCP’s sparse matrix estimate was only off from the ground truth <code>S_0</code> by 5.92%.</p>
<p>We can now pair our estimated <code>L</code> matrix with any matrix factorization method of our choice (e.g. factor analysis or NMF) to extract the latent chemical exposure patterns. These patterns, along with the isolated outlying exposure events in <code>S</code>, can then be incorporated with any outcomes of interest in downstream epidemiological analyses.</p>
</div>
</div>
<div class="section level2">
<h2 id="a-real-world-application">A real world application<a class="anchor" aria-label="anchor" href="#a-real-world-application"></a>
</h2>
<p>The <code>pcpr</code> package also ships with a real world air pollution dataset <code>queens</code> consisting of fine particulate matter measurements (in µg/m^3) of 26 PM2.5 chemical species, recorded every three to six days from 04/04/2001 through 12/30/2021 courtesy of an EPA AQS monitoring site in Queens, New York City (NYC):</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">queens</span></span>
<span><span class="co">#&gt; # A tibble: 2,443 × 27</span></span>
<span><span class="co">#&gt;    Date            Al   NH4      As     Ba       Br     Cd      Ca      Cl</span></span>
<span><span class="co">#&gt;    &lt;date&gt;       &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 2001-04-04 NA      1.62  NA      NA     NA       NA     NA      NA     </span></span>
<span><span class="co">#&gt;  2 2001-04-07  0      2.66   0       0.012  0.00488  0      0.0401  0.0079</span></span>
<span><span class="co">#&gt;  3 2001-04-13  0.0094 1.41   0.0016  0.024  0.00211  0.004  0.036   0     </span></span>
<span><span class="co">#&gt;  4 2001-04-19  0.0104 1.22   0.001   0.006  0.00422  0      0.0543  0.003 </span></span>
<span><span class="co">#&gt;  5 2001-04-25  0.0172 0.723  0.0024  0.015  0.00117  0      0.0398  0     </span></span>
<span><span class="co">#&gt;  6 2001-05-01  0.0384 3.48   0.0017  0.041  0.00873  0.001  0.136   0     </span></span>
<span><span class="co">#&gt;  7 2001-05-04  0.0964 6.22   0.0025  0.039  0.0111   0      0.137   0     </span></span>
<span><span class="co">#&gt;  8 2001-05-07  0.004  0.233  0.001   0.016  0.00263  0      0.055   0.0054</span></span>
<span><span class="co">#&gt;  9 2001-05-10  0.0547 2.04   0.001   0.055  0.00521  0      0.121   0.001 </span></span>
<span><span class="co">#&gt; 10 2001-05-13  0.0215 0.229  0       0.021  0.00122  0      0.0249  0     </span></span>
<span><span class="co">#&gt; # ℹ 2,433 more rows</span></span>
<span><span class="co">#&gt; # ℹ 18 more variables: Cr &lt;dbl&gt;, Cu &lt;dbl&gt;, EC &lt;dbl&gt;, Fe &lt;dbl&gt;, Pb &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   Mg &lt;dbl&gt;, Mn &lt;dbl&gt;, Ni &lt;dbl&gt;, OC &lt;dbl&gt;, K &lt;dbl&gt;, Se &lt;dbl&gt;, Si &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   Na &lt;dbl&gt;, S &lt;dbl&gt;, Ti &lt;dbl&gt;, NO3 &lt;dbl&gt;, V &lt;dbl&gt;, Zn &lt;dbl&gt;</span></span></code></pre></div>
<p>You can follow along a real source apportionment analysis using the <code>queens</code> data in the source apportionment vignette.</p>
</div>
<div class="section level2">
<h2 id="pcp-in-environmental-health-studies">PCP in environmental health studies<a class="anchor" aria-label="anchor" href="#pcp-in-environmental-health-studies"></a>
</h2>
<p>The methods in <code>pcpr</code> have already been applied in many environmental health studies. Several are listed below:</p>
<ul>
<li>
<a href="https://doi.org/10.1097/EE9.0000000000000243" class="external-link">Tao et al. (2023)</a> apply PCP to investigate the association between source-specific fine particulate matter and myocardial infarction hospitalizations in NYC.</li>
<li>
<a href="https://doi.org/10.1021/acs.est.3c10314" class="external-link">Wu et al. (2024)</a> employ PCP for exposome profiling of environmental pollutants in seminal plasma, uncovering novel associations with semen parameters.</li>
<li>
<a href="https://doi.org/10.1016/j.envint.2024.108526" class="external-link">Benavides et al. (2024)</a> use PCP to develop a Community Severity Index in NYC, measuring the barrier effect of road infrastructure and traffic in cities.</li>
</ul>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Gibson, Elizabeth A., Junhui Zhang, Jingkai Yan, Lawrence Chillrud, Jaime Benavides, Yanelli Nunez, Julie B. Herbstman, Jeff Goldsmith, John Wright, and Marianthi-Anna Kioumourtzoglou. “Principal component pursuit for pattern identification in environmental mixtures.” Environmental Health Perspectives 130, no. 11 (2022): 117008. [available <a href="https://doi.org/10.1289/EHP10479" class="external-link">here</a>]</p>
<p>Zhang, Junhui, Jingkai Yan, and John Wright. “Square root principal component pursuit: tuning-free noisy robust matrix recovery.” Advances in Neural Information Processing Systems 34 (2021): 29464-29475. [available <a href="https://proceedings.neurips.cc/paper/2021/hash/f65854da4622c1f1ad4ffeb361d7703c-Abstract.html" class="external-link">here</a>]</p>
<p>Cherapanamjeri, Yeshwanth, Kartik Gupta, and Prateek Jain. “Nearly optimal robust matrix completion.” International Conference on Machine Learning. PMLR, (2017). [available <a href="https://proceedings.mlr.press/v70/cherapanamjeri17a.html" class="external-link">here</a>]</p>
<p>Tao, Rachel H., Lawrence G. Chillrud, Yanelli Nunez, Sebastian T. Rowland, Amelia K. Boehme, Jingkai Yan, Jeff Goldsmith, John Wright, and Marianthi-Anna Kioumourtzoglou. “Applying principal component pursuit to investigate the association between source-specific fine particulate matter and myocardial infarction hospitalizations in New York City.” Environmental Epidemiology 7 (2), (2023). [available <a href="https://doi.org/10.1097/EE9.0000000000000243" class="external-link">here</a>]</p>
<p>Wu, Haotian, Vrinda Kalia, Katherine E. Manz, Lawrence Chillrud, Nathalie Hoffmann Dishon, Gabriela L. Jackson, Christian K. Dye, Raoul Orvieto, Adva Aizer, Hagai Levine, Marianthi-Anna Kioumourtzoglou, Kurt D. Pennell, Andrea A. Baccarelli, and Ronit Machtinger. “Exposome Profiling of Environmental Pollutants in Seminal Plasma and Novel Associations with Semen Parameters.” Environmental Science &amp; Technology, 58 (31), (2024): 13594-13604. [available <a href="https://doi.org/10.1021/acs.est.3c10314" class="external-link">here</a>]</p>
<p>Benavides, Jaime, Sabah Usmani, Vijay Kumar, and Marianthi-Anna Kioumourtzoglou. “Development of a community severance index for urban areas in the United States: A case study in New York City.” Environment International, 185, (2024): 108526. [available <a href="https://doi.org/10.1016/j.envint.2024.108526" class="external-link">here</a>]</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/Columbia-PRIME/pcpr/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/Columbia-PRIME/pcpr/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing pcpr</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://lawrence-chillrud.github.io/" class="external-link">Lawrence G. Chillrud</a> <br><small class="roles"> Author, maintainer, copyright holder </small> <a href="https://orcid.org/0000-0003-0727-0161" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>
<a href="https://www.linkedin.com/in/jaime-benavides-72959356/" class="external-link">Jaime Benavides</a> <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-1851-5155" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>
<a href="https://lizzy.codes/index.html" class="external-link">Elizabeth A. Gibson</a> <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0001-5119-5133" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>
<a href="https://scholar.google.com/citations?user=LyLU8koAAAAJ&amp;hl=en" class="external-link">Junhui Zhang</a> <br><small class="roles"> Author </small> <a href="https://orcid.org/0009-0008-5922-1058" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>
<a href="https://www.linkedin.com/in/jingkai-yan-a49a9516a/" class="external-link">Jingkai Yan</a> <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-2094-2092" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>
<a href="https://www.columbia.edu/~jw2966/" class="external-link">John N. Wright</a> <br><small class="roles"> Author </small>  </li>
<li>
<a href="https://jeffgoldsmith.com/" class="external-link">Jeff Goldsmith</a> <br><small class="roles"> Author </small>  </li>
<li>
<a href="https://marianthi.github.io/makLAB.github.io/" class="external-link">Marianthi-Anna Kioumourtzoglou</a> <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0001-5710-4992" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>
<a href="https://www.columbia.edu/" class="external-link">Columbia University</a> <br><small class="roles"> Funder </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=pcpr" class="external-link"><img src="https://www.r-pkg.org/badges/version/pcpr" alt="CRAN status"></a></li>
<li><a href="https://github.com/Columbia-PRIME/pcpr/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/Columbia-PRIME/pcpr/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://www.gnu.org/licenses/gpl-3.0" class="external-link"><img src="https://img.shields.io/badge/License-GPLv3-blue.svg" alt="License: GPL v3"></a></li>
<li><a href="https://cranlogs.r-pkg.org/badges/grand-total/pcpr" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/grand-total/pcpr" alt="Total Downloads"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://lawrence-chillrud.github.io/" class="external-link">Lawrence G. Chillrud</a>, <a href="https://www.linkedin.com/in/jaime-benavides-72959356/" class="external-link">Jaime Benavides</a>, <a href="https://lizzy.codes/index.html" class="external-link">Elizabeth A. Gibson</a>, <a href="https://scholar.google.com/citations?user=LyLU8koAAAAJ&amp;hl=en" class="external-link">Junhui Zhang</a>, <a href="https://www.linkedin.com/in/jingkai-yan-a49a9516a/" class="external-link">Jingkai Yan</a>, <a href="https://www.columbia.edu/~jw2966/" class="external-link">John N. Wright</a>, <a href="https://jeffgoldsmith.com/" class="external-link">Jeff Goldsmith</a>, <a href="https://marianthi.github.io/makLAB.github.io/" class="external-link">Marianthi-Anna Kioumourtzoglou</a>, <a href="https://www.columbia.edu/" class="external-link">Columbia University</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
